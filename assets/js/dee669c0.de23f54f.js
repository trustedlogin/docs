"use strict";(self.webpackChunktrustedlogin_docs=self.webpackChunktrustedlogin_docs||[]).push([[751],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},k="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,p=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),k=s(n),d=i,c=k["".concat(p,".").concat(d)]||k[d]||m[d]||l;return n?a.createElement(c,o(o({ref:t},u),{},{components:n})):a.createElement(c,o({ref:t},u))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,o=new Array(l);o[0]=d;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r[k]="string"==typeof e?e:i,o[1]=r;for(var s=2;s<l;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7576:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>r,toc:()=>s});var a=n(7462),i=(n(7294),n(3905));const l={},o="Working with Vault",r={unversionedId:"SaaS/vault",id:"SaaS/vault",title:"Working with Vault",description:"An instance of HashiCorp Vault is used to store all sensitive data about customer sites.",source:"@site/docs/SaaS/vault.md",sourceDirName:"SaaS",slug:"/SaaS/vault",permalink:"/SaaS/vault",draft:!1,editUrl:"https://github.com/trustedlogin/docs/edit/main/docs/SaaS/vault.md",tags:[],version:"current",frontMatter:{},sidebar:"SaaS",previous:{title:"The Vault SaaS Token",permalink:"/SaaS/vault-sass-token"},next:{title:"Webhooks",permalink:"/SaaS/webhooks"}},p={},s=[{value:"Check TTL Of Auth Token",id:"check-ttl-of-auth-token",level:2},{value:"Renew Auth Token",id:"renew-auth-token",level:2},{value:"Request That A Key Store Be Created For Vendor",id:"request-that-a-key-store-be-created-for-vendor",level:2},{value:"Request Short-Term Token For Client Plugin To Create Site With",id:"request-short-term-token-for-client-plugin-to-create-site-with",level:2},{value:"Request Access Logs For A Site",id:"request-access-logs-for-a-site",level:2},{value:"Request That A Site Be Removed Form Vault",id:"request-that-a-site-be-removed-form-vault",level:2},{value:"Request Short-Term Token For Support-side Plugin To Read Site data",id:"request-short-term-token-for-support-side-plugin-to-read-site-data",level:2}],u={toc:s},k="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(k,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"working-with-vault"},"Working with Vault"),(0,i.kt)("p",null,"An instance of ",(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io"},"HashiCorp Vault")," is used to store all sensitive data about customer sites."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"The URL of Vault is: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://vault.trustedlogin.com")),(0,i.kt)("li",{parentName:"ul"},'The "app\'s auth token" Refers to the token used to identify this app, with Vault.',(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"This token should grant the ability to take these actions and no others."))),(0,i.kt)("li",{parentName:"ul"},'The "SaaS Token" is ',(0,i.kt)("a",{parentName:"li",href:"/SaaS/vault-sass-token"},"documented here")))),(0,i.kt)("h2",{id:"check-ttl-of-auth-token"},"Check TTL Of Auth Token"),(0,i.kt)("p",null,"To check the TTL of the current token used by the app to authenticate against vault:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io/api/auth/token/index.html#lookup-a-token-self-"},"API Docs"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"URI - ",(0,i.kt)("inlineCode",{parentName:"p"},"/v1/auth/token/lookup-self")," ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"p"},"GET"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"p"},"'X-Vault-Token':<token>"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Request Body: None")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Example Response:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "request_id": "ac4a1ed6-64f7-6cca-2f38-182efdf37e4a",\n    "lease_id": "",\n    "renewable": false,\n    "lease_duration": 0,\n    "data": {\n        "accessor": "X9H1u4IrPFgbUmjhToXtH5mq",\n        "creation_time": 1557336326,\n        "creation_ttl": 0,\n        "display_name": "root",\n        "entity_id": "",\n        "expire_time": null,\n        "explicit_max_ttl": 0,\n        "id": "s.KODayxpVxBLBw8MxZdRKTU7r",\n        "meta": null,\n        "num_uses": 0,\n        "orphan": true,\n        "path": "auth/token/root",\n        "policies": [\n            "root"\n        ],\n        "ttl": 0,\n        "type": "service"\n    },\n    "wrap_info": null,\n    "warnings": null,\n    "auth": null\n}\n')),(0,i.kt)("h2",{id:"renew-auth-token"},"Renew Auth Token"),(0,i.kt)("p",null,"To renew the app's auth token for longer use:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/auth/token/index.html#renew-a-token-self-"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/auth/token/renew-self")," "),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"POST")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "increment": "42h" \n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "request_id": "e113b883-0241-e8f0-39a9-b1fded129c63",\n    "lease_id": "",\n    "renewable": false,\n    "lease_duration": 0,\n    "data": null,\n    "wrap_info": null,\n    "warnings": null,\n    "auth": {\n        "client_token": "s.XWBIrPzWxZaobgtZRwwV0der",\n        "accessor": "DSHxCZA9fWVjtKIBmNhEsQ1x",\n        "policies": [\n            "default",\n            "saas-policy"\n        ],\n        "token_policies": [\n            "default",\n            "saas-policy"\n        ],\n        "metadata": null,\n        "lease_duration": 151200,\n        "renewable": true,\n        "entity_id": "",\n        "token_type": "service",\n        "orphan": false\n    }\n}\n')),(0,i.kt)("h2",{id:"request-that-a-key-store-be-created-for-vendor"},"Request That A Key Store Be Created For Vendor"),(0,i.kt)("p",null,"Vault can have a specific database or key store per vendor. When a vendor signs up, a new key store is created."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The Key Store will be called ",(0,i.kt)("inlineCode",{parentName:"p"},"<namespace>-store")," where ",(0,i.kt)("inlineCode",{parentName:"p"},"<namespace>")," is a variable identifying the Client's project. (eg Key Store name = ",(0,i.kt)("inlineCode",{parentName:"p"},"gravityview-store")," for ",(0,i.kt)("inlineCode",{parentName:"p"},"GravityView")," project.). It is in the URI.")),(0,i.kt)("p",null,"To request a new key store for a vendor:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/system/mounts.html#enable-secrets-engine"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/sys/mounts/<namespace>-store")," "),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"POST")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "type": "kv",\n    "description":"Key Store for client X",\n    "options": {\n        "version": "1"\n    }\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response: 204 - No Content")),(0,i.kt)("p",null,"Once this is received, create policies for Client Plugin Token and Delete Site permissions:"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},"Policy will be called ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>-write-policy")," where ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>")," is a variable identifying the Client's project. (eg Policy name = ",(0,i.kt)("inlineCode",{parentName:"li"},"gravityview-write-policy")," for ",(0,i.kt)("inlineCode",{parentName:"li"},"GravityView")," project.). This is in the URI."),(0,i.kt)("li",{parentName:"ol"},"The Key Store name from before ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>-store")," is used in the Request Body. "))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/system/policies.html#create-update-acl-policy"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/sys/policies/acl/<namespace>-write-policy")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"PUT")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "policy": "path \\"<namespace>-store/*\\" { capabilities = [\\"create\\", \\"update\\", \\"delete\\"]}"\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response: 204 - No Content")),(0,i.kt)("p",null,"and:"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},"Policy will be called ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>-delete-policy")," where ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>")," is a variable identifying the Client's project. (eg Policy name = ",(0,i.kt)("inlineCode",{parentName:"li"},"gravityview-delete-policy")," for ",(0,i.kt)("inlineCode",{parentName:"li"},"GravityView")," project.). This is in the URI."),(0,i.kt)("li",{parentName:"ol"},"This policy is used to create a token that extends SaaS privileges to be able to remove Sites from Key Store."),(0,i.kt)("li",{parentName:"ol"},"The Key Store name from before ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>-store")," is used in the Request Body. "))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/system/policies.html#create-update-acl-policy"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/sys/policies/acl/<namespace>-delete-policy")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"PUT")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "policy": "path \\"<namespace>-store/*\\" { capabilities = [\\"delete\\"]}"\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response: 204 - No Content")),(0,i.kt)("p",null,"and:"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},"Policy will be called ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>-read-policy")," where ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>")," is a variable identifying the Client's project. (eg Policy name = ",(0,i.kt)("inlineCode",{parentName:"li"},"gravityview-read-policy")," for ",(0,i.kt)("inlineCode",{parentName:"li"},"GravityView")," project.). This is in the URI."),(0,i.kt)("li",{parentName:"ol"},"This policy is used to create a token for Support-side plugin to read secrets from ONLY ",(0,i.kt)("inlineCode",{parentName:"li"},"<namesspace>-store"),"."),(0,i.kt)("li",{parentName:"ol"},"The Key Store name from before ",(0,i.kt)("inlineCode",{parentName:"li"},"<namespace>-store")," is used in the Request Body."))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/system/policies.html#create-update-acl-policy"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/sys/policies/acl/<namespace>-read-policy")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"PUT")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "policy": "path \\"<namespace>-store/*\\" { capabilities = [\\"read\\"]}"\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response: 204 - No Content")),(0,i.kt)("h2",{id:"request-short-term-token-for-client-plugin-to-create-site-with"},"Request Short-Term Token For Client Plugin To Create Site With"),(0,i.kt)("p",null,"The client plugin will make requests to this app's ",(0,i.kt)("inlineCode",{parentName:"p"},"POST /api/site")," endpoint to request a token it can use to create site in Vault."),(0,i.kt)("p",null,"To get that token from Vault:"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"<namespace>-write-policy")," in Request Body was defined above and tells the token what it can/can't access")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/auth/token/index.html#create-token"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/auth/token/create")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"POST")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n      "policies": [\n        "<namespace>-write-policy"\n      ],\n      "metadata": {\n        "key": "value",\n      },\n      "ttl": "7d",\n      "renewable": true,\n      "display_name": "Write Token",\n    }\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "request_id": "...", // string\n    "wrap_info": null,\n    "warnings": null,\n    "auth": {\n        "client_token": "...", // string\n        "accessor": "...", // string\n        "policies": [\n            "default",\n            "gravityview-write-policy" // the policy defining permissions\n        ],\n        "token_policies": [\n            "default",\n            "gravityview-write-policy" // the policy defining permissions\n        ],\n        "metadata": null,\n        "lease_duration": 1296000,\n        "renewable": true,\n        "entity_id": "",\n        "token_type": "service",\n        "orphan": false\n    }\n}\n')),(0,i.kt)("h2",{id:"request-access-logs-for-a-site"},"Request Access Logs For A Site"),(0,i.kt)("p",null,"To get access logs for a specific site, app can make a this request to Vault:"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"This documentation is incomplete. We are working on it.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/...")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ..."),(0,i.kt)("li",{parentName:"ul"},"Required Headers ..."),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "hi": "roy"\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "hi": "roy"\n}\n')),(0,i.kt)("h2",{id:"request-that-a-site-be-removed-form-vault"},"Request That A Site Be Removed Form Vault"),(0,i.kt)("p",null,"If the app needs to remove record of a site login, it can make this request to Vault:"),(0,i.kt)("p",null,"First need to create a temporary token with delete permissions. Then use this Token to give SaaS the ability to delete Site info."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"<token>")," (the SaaS token) is used in Headers. ",(0,i.kt)("inlineCode",{parentName:"p"},"<namespace>-delete-policy")," in Request Body was defined above and tells the token what it can/can't access")),(0,i.kt)("p",null,"To get that token from Vault:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/auth/token/index.html#create-token"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/auth/token/create")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"POST")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n      "policies": [\n        "<namespace>-delete-policy"\n      ],\n      "ttl": "1d",\n      "renewable": false,\n      "display_name": "Delete Token",\n    }\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "request_id": "...",\n    "wrap_info": null,\n    "warnings": null,\n    "auth": {\n        "client_token": "<deleteToken>",\n        "accessor": "...",\n        "policies": [\n            "default",\n            "gravityview-delete-policy"\n        ],\n        "token_policies": [\n            "default",\n            "gravityview-delete-policy"\n        ],\n        "metadata": null,\n        "lease_duration": 1296000,\n        "renewable": true,\n        "entity_id": "",\n        "token_type": "service",\n        "orphan": false\n    }\n}\n')),(0,i.kt)("p",null,"Then use that generated token to delete the secret:"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"<deleteToken>")," (from above) is used in Headers instead of ",(0,i.kt)("inlineCode",{parentName:"li"},"<token>"),".\n2: ",(0,i.kt)("inlineCode",{parentName:"li"},"<secret-id>")," is provided from Client-side plugin in the request body sent to SaaS via ",(0,i.kt)("inlineCode",{parentName:"li"},"POST /sites")))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io/api/secret/kv/kv-v1.html#delete-secret"},"API Docs"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"URI - ",(0,i.kt)("inlineCode",{parentName:"p"},"/v1/<namespace>-store/<secret-id>"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"p"},"DELETE"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"p"},"'X-Vault-Token': <deleteToken>"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Request Body: None")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Example Response: 204 - No Content"))),(0,i.kt)("h2",{id:"request-short-term-token-for-support-side-plugin-to-read-site-data"},"Request Short-Term Token For Support-side Plugin To Read Site data"),(0,i.kt)("p",null,"The support-side plugin will make requests to the SaaS app to get a token it can use to read sites in Vault."),(0,i.kt)("p",null,"To get that token from Vault:"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"<namespace>-read-policy")," in Request Body was defined above and tells the token what it can/can't access")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/api/auth/token/index.html#create-token"},"API Docs")),(0,i.kt)("li",{parentName:"ul"},"URI - ",(0,i.kt)("inlineCode",{parentName:"li"},"/v1/auth/token/create")),(0,i.kt)("li",{parentName:"ul"},"HTTP Method - ",(0,i.kt)("inlineCode",{parentName:"li"},"POST")),(0,i.kt)("li",{parentName:"ul"},"Required Headers ",(0,i.kt)("inlineCode",{parentName:"li"},"'Content-Type':'application/json','X-Vault-Token':<token>")),(0,i.kt)("li",{parentName:"ul"},"Request Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n      "policies": [\n        "<namespace>-read-policy"\n      ],\n      "ttl": "24h",\n      "renewable": true,\n      "display_name": "Support-side Token",\n    }\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Example Response:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "request_id": "...", // string\n    "wrap_info": null,\n    "warnings": null,\n    "auth": {\n        "client_token": "...", // string\n        "accessor": "...", // string\n        "policies": [\n            "default",\n            "gravityview-write-policy" // the policy defining permissions\n        ],\n        "token_policies": [\n            "default",\n            "gravityview-write-policy" // the policy defining permissions\n        ],\n        "metadata": null,\n        "lease_duration": 1296000,\n        "renewable": true,\n        "entity_id": "",\n        "token_type": "service",\n        "orphan": false\n    }\n}\n')))}m.isMDXComponent=!0}}]);